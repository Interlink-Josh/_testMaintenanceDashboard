{
  "nn_update_when_hidden": false,
  "nn_uses_views": false,
  "nn_dashboard_id": 73,
  "nn_data_converter_template": "",
  "nn_widget_id": "connection",
  "nn_initial_widget_view": "",
  "nn_width": "25%",
  "nn_real_time_feed": false,
  "nn_left_pos": "1%",
  "nn_caption": "",
  "nn_lock_position": false,
  "nn_fc_template": "<div class=\"form-group\"  title=\"Maintenance Host\" style=\"margin-top:2%;\">\n    <!-- <label for=\"connectionList\">Maintenance Host</label> -->\n    <select class=\"form-control\" id=\"connectionList\" placeholder=\"Maintenance Host\">\n    </select>\n  </div>\n  <script>\n  \n  $(document).on('nn_all_created', function(){\n        var connectionWidgetList = ['maintenanceList','recordDisplay','dataWidget'];\n        var connectionsURL = '/nn/services/Connection?host-!eq=internal&instance-!eq=internal&i=host-maintenanceHost-maintenanceHostTimeZone&format=application/json';\n        var optionHTML = function(item){var value=item['properties']['host'] + item['properties']['maintenanceHost'] ; var label = item['properties']['host']; return '<option data-timezone=\"'+item['properties']['maintenanceHostTimeZone']+'\" value=\"'+value+'\">'+label+'</option>'};\n        \n        function maintenanceHostChange(e,d){\n            var val = e.currentTarget ? e.currentTarget.value : e;\n            NET_NOW.dashboard.setVar('maintenanceHost', val);\n            $.each(connectionWidgetList, function(i,w){\n                var widget = NET_NOW.dashboard.getWidget(w);\n                var oldURL  = widget.attributes.chartDataSource;\n                var newURL = oldURL.replace(/^.*\\/maintenance/, val)\n                // console.log('newURL',newURL)\n                // Update widget\n                widget.attributes.chartDataSource = newURL;\n                widget.reload();\n            });\n            // Set connection timezone display\n            var timezoneDisplaySelector = '#connection-timezone';\n            var connectionListSelector = '#connectionList';\n            var targetVal = $(connectionListSelector).val();\n            var maintenanceHostTimeZone = $(connectionListSelector).children().filter(function(i,e){return $(e).val() == targetVal}).data('timezone');\n            console.log(maintenanceHostTimeZone,e.currentTarget);\n            require(['moment-timezone'], function(moment){\n            console.log(maintenanceHostTimeZone);\n            maintenanceHostTimeZone = maintenanceHostTimeZone || moment.tz.guess();\n                $(timezoneDisplaySelector).text(maintenanceHostTimeZone);\n            }.bind(maintenanceHostTimeZone));\n            \n        };\n        \n        // Get connections\n        $.ajax(connectionsURL).then(function(res){\n            var connections = res['response']['content'];\n            //connections.push({'properties': {'host': 'example.com','maintenanceHost':'/service/maintenance'}})\n            $('#${widget.widgetId}').data('connections', $.extend([],connections));\n            // Clear options\n            $('#connectionList option').remove();\n            // re add options\n            var firstConnection = '/services/maintenance/';\n            $.each(connections, function(index, item){ if(index === 0){firstConnection = item['properties']['host'] + item['properties']['maintenanceHost'];};$('#connectionList').append(optionHTML(item));});\n            // initialize\n            maintenanceHostChange(firstConnection);\n            if($('#connectionList option').length <= 1){\n                $('#connectionList').attr('disabled', true);\n            };\n        });\n        \n        $('#connectionList').off('change').on('change', maintenanceHostChange);\n        \n  });\n  </script>",
  "nn_backbone_view": "textbox-view",
  "nn_height": "5%",
  "nn_widget_type": "textboxwidget",
  "nn_z_index": "100",
  "nn_x_axis": "",
  "nn_copy_params_tourl": false,
  "nn_warning_interval": 0,
  "nn_default_view_data": "",
  "nn_containing_tab_num": "",
  "nn_containing_widget": "",
  "nn_display_name": "Dynamic Text Box",
  "nn_refresh_interval": 0,
  "nn_top_pos": "8%",
  "nn_chart_config_file": "TextBox.ftl",
  "nn_settings": "{\"degradedServices\":{\"always\":false,\"offline\":false,\"peak\":false,\"offpeak\":false},\"loadOwnData\":false,\"serviceSummaryColumns\":{\"slaImpact\":true,\"slaType\":true,\"managed\":true,\"targetFix\":true,\"details\":true,\"history\":false,\"availability\":true},\"withAlerts\":{\"always\":false,\"offline\":false,\"peak\":false,\"offpeak\":false}}",
  "nn_data_source_type": "None",
  "nn_id": 393,
  "nn_hide_on_startup": false,
  "nn_y_axis": "",
  "nn_widgets_idx": 1
}
